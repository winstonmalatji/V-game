<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>For Londiwe ‚ù§Ô∏è</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, sans-serif;
    background: #ff9a9e; 
    overflow: hidden; /* No scrolling allowed */
    touch-action: none; /* Disables standard browser gestures */
    -webkit-user-select: none;
    user-select: none;
    width: 100vw;
    height: 100vh;
    height: 100dvh;
  }

  /* --- SCREEN MANAGEMENT --- */
  .screen {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    display: none; /* Hidden by default */
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: linear-gradient(180deg, #ff9a9e, #fad0c4);
    z-index: 10;
    padding: 20px;
    box-sizing: border-box;
  }

  /* These classes force the screen to show */
  .visible-flex { display: flex !important; }
  .visible-block { display: block !important; }

  /* --- TEXT STYLES --- */
  h1 {
    font-size: 2rem;
    margin-bottom: 20px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    color: #fff;
    text-align: center;
  }

  p {
    font-size: 1.2rem;
    color: #fff;
    margin: 10px 0;
    line-height: 1.5;
    text-align: center;
    max-width: 90%;
  }

  /* --- GAME ELEMENTS --- */
  #score {
    position: absolute;
    top: max(20px, env(safe-area-inset-top));
    left: 0;
    width: 100%;
    text-align: center;
    font-size: 1.5rem;
    font-weight: bold;
    color: #fff;
    z-index: 5;
    pointer-events: none; /* Lets touches pass through */
  }

  #basket {
    position: absolute;
    bottom: max(30px, env(safe-area-inset-bottom));
    left: 50%;
    transform: translateX(-50%);
    font-size: 4.5rem;
    line-height: 1;
    z-index: 5;
    pointer-events: none; /* Lets touches pass through so you can drag anywhere */
  }

  .heart {
    position: absolute;
    top: -50px;
    font-size: 2.5rem;
    z-index: 4;
    pointer-events: none;
  }

  /* --- END SCREEN --- */
  #screen-end {
    background: rgba(0,0,0,0.9);
    z-index: 100;
  }

  #screen-end h2 {
    font-size: 2.5rem;
    color: #ff9a9e;
    margin-bottom: 20px;
  }

  /* --- BUTTONS --- */
  button {
    margin-top: 25px;
    padding: 15px 40px;
    font-size: 1.2rem;
    border: none;
    border-radius: 50px;
    font-weight: bold;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  
  button:active { transform: scale(0.95); }

  .primary { background: #fff; color: #ff9a9e; }
  .yes { background: #ff4d6d; color: #fff; margin: 10px; }
  .no { background: #fff; color: #333; margin: 10px; }
  
  .btn-group { display: flex; gap: 10px; }

</style>
</head>
<body>

<div id="screen-greeting" class="screen visible-flex">
  <h1>Hi Londiwe ‚ù§Ô∏è</h1>
  <p>I made a little game just for you.</p>
  <button class="primary" onclick="goToInstructions()">Next</button>
</div>

<div id="screen-instructions" class="screen">
  <h1>How to play</h1>
  <p>1. Drag your finger anywhere left & right.</p>
  <p>2. Catch the falling hearts.</p>
  <p>3. Collect 7 hearts to win.</p>
  <button class="primary" onclick="goToGame()">Start</button>
</div>

<div id="screen-game" class="screen">
  <div id="score">0 / 7</div>
  <div id="basket">üíù</div>
</div>

<div id="screen-end" class="screen">
  <h2 id="endTitle">Londiwe...</h2>
  <p id="endMessage">I loved making this for you.</p>
  <p id="endQuestion">Will you be my Valentine? ‚ù§Ô∏è</p>
  <div class="btn-group" id="finalButtons">
    <button class="yes" onclick="answerYes()">YES</button>
    <button class="no" onclick="answerNo()">NO</button>
  </div>
</div>

<script>
  // --- VARIABLES ---
  let score = 0;
  const target = 7;
  let spawnLoop;
  let activeHearts = [];
  const basket = document.getElementById("basket");
  const scoreText = document.getElementById("score");
  let gameRunning = false; // New flag to track game state safely

  // --- SCREEN MANAGER ---
  function switchScreen(screenId, displayType = 'flex') {
    // Hide all screens
    document.querySelectorAll('.screen').forEach(s => {
      s.classList.remove('visible-flex');
      s.classList.remove('visible-block');
    });

    // Show target screen
    const targetScreen = document.getElementById(screenId);
    if (displayType === 'flex') {
      targetScreen.classList.add('visible-flex');
    } else {
      targetScreen.classList.add('visible-block');
    }
  }

  // --- NAVIGATION ---
  function goToInstructions() {
    switchScreen('screen-instructions');
  }

  function goToGame() {
    switchScreen('screen-game', 'block');
    startGameLogic();
  }

  function goToEnd() {
    gameRunning = false;
    clearInterval(spawnLoop);
    activeHearts.forEach(h => {
        h.element.remove();
        clearInterval(h.interval);
    });
    activeHearts = [];
    switchScreen('screen-end');
  }

  // --- GAME LOGIC ---
  function startGameLogic() {
    score = 0;
    scoreText.textContent = "0 / 7";
    gameRunning = true;
    
    // Start Spawning
    spawnLoop = setInterval(createHeart, 800);
  }

  // --- TOUCH CONTROLS (FIXED) ---
  // We attach the listener to the whole window to ensure we catch every movement
  window.addEventListener("touchmove", function(e) {
    if (!gameRunning) return; // Only move if game is actually running
    
    e.preventDefault(); // Stop scrolling
    
    let touch = e.touches[0];
    let x = touch.clientX;
    
    // Keep basket inside screen
    if(x < 0) x = 0;
    if(x > window.innerWidth) x = window.innerWidth;
    
    basket.style.left = x + "px";
  }, { passive: false });

  // Also add touchstart to prevent default scrolling behavior immediately
  window.addEventListener("touchstart", function(e) {
    if (gameRunning) {
        e.preventDefault();
    }
  }, { passive: false });

  // Mouse Controls (for testing on PC)
  window.addEventListener("mousemove", function(e) {
    if (!gameRunning) return;
    basket.style.left = e.clientX + "px";
  });

  function createHeart() {
    const heart = document.createElement("div");
    heart.className = "heart";
    heart.textContent = "‚ù§Ô∏è";
    heart.style.left = Math.random() * (window.innerWidth - 50) + "px";
    document.getElementById('screen-game').appendChild(heart);

    let y = -50;
    const speed = 4 + Math.random() * 3;

    const fall = setInterval(() => {
      y += speed;
      heart.style.top = y + "px";

      // Collision
      const hRect = heart.getBoundingClientRect();
      const bRect = basket.getBoundingClientRect();

      if (
        hRect.bottom > bRect.top + 15 &&
        hRect.top < bRect.bottom &&
        hRect.right > bRect.left &&
        hRect.left < bRect.right
      ) {
        score++;
        scoreText.textContent = `${score} / ${target}`;
        
        heart.remove();
        clearInterval(fall);
        
        if (score >= target) {
          goToEnd();
        }
      }

      if (y > window.innerHeight) {
        heart.remove();
        clearInterval(fall);
      }
    }, 16);

    activeHearts.push({ element: heart, interval: fall });
  }

  // --- FINAL ANSWER ---
  function answerYes() {
    document.getElementById('endTitle').textContent = "Yay! ‚ù§Ô∏è";
    document.getElementById('endMessage').textContent = "You just made my day.";
    document.getElementById('endQuestion').textContent = "Happy Valentine‚Äôs Day!";
    document.getElementById('finalButtons').style.display = 'none';
    launchConfetti();
  }

  function answerNo() {
    document.getElementById('endTitle').textContent = "Okay üå∏";
    document.getElementById('endMessage').textContent = "Thanks for playing anyway.";
    document.getElementById('endQuestion').textContent = "You're still awesome.";
    document.getElementById('finalButtons').style.display = 'none';
  }

  function launchConfetti() {
    for (let i = 0; i < 50; i++) {
      const c = document.createElement("div");
      c.textContent = "üíñ";
      c.style.position = "fixed";
      c.style.left = Math.random() * 100 + "vw";
      c.style.top = "-20px";
      c.style.fontSize = (Math.random() * 20 + 20) + "px";
      c.style.zIndex = "200";
      document.body.appendChild(c);

      let y = -20;
      const speed = 3 + Math.random() * 4;
      const fall = setInterval(() => {
        y += speed;
        c.style.top = y + "px";
        if (y > window.innerHeight) {
          c.remove();
          clearInterval(fall);
        }
      }, 16);
    }
  }
</script>
</body>
</html>